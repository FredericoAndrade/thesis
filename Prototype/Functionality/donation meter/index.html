<!DOCTYPE html>
<html>
    <head>

        <meta
            http-equiv="Content-Type"
            content="text/html; charset=UTF-8">

        <link
            rel="shortcut icon"
            href="http://fredericoandrade.com/images/favicon.ico">

        <link
            href="style.css"
            rel="stylesheet"
            type="text/css">

        <link
            href='http://fonts.googleapis.com/css?family=Open+Sans:300'
            rel='stylesheet'
            type='text/css'>

        <title>
            FREDERICO ANDRADE - INTERACTION DESIGNER - Thesis Functionality Protoype 01</title>

        <script>
//mathematic values
        var goal=100,
			current = 14
//modifier
        var currentAngle = (current/goal)*360
        </script>

    </head>

    <body>
        <div id="overlay">

            <div id="readout">
                <h1 class="goal">
                    Goal: $
                    <script type="text/javascript">
                    document.write(goal);
                    </script>
                </h1>

                <h1 class="goal">
                    Funded: $
                    <script type="text/javascript">
                    document.write(current);
                    </script>

                </h1>

                <input
                    id="input"
                    name="currency"
                    type="number"
                    step="1"
                    min="0"
                    value='0'/>
                    <!--Value does not change based on fill Value-->
            </div>

            <canvas
                onmousedown="showCoords(event)"
                id="canvas"
                width="350"
                height="350">
            </canvas><!--canvas size determined here-->

        </div>

        <script>
		var canvas = document.getElementById('canvas'),
            ctx = canvas.getContext('2d')

//graphic values
        var origin = 175,
            radius = 100,
            lineW = 1.5*(radius),
            core = (radius/3.5),
            target = [],
            rot = Math.PI*-.5
            document.getElementById("input").addEventListener("change",false)


//pie-chart mouse-click value log
        function showCoords(evt){
            var eY = evt.layerY,
                eX = evt.layerX,
                //this breaks the chart into sectors
                //then it figures out the angle of the click from the origin
                s1 = Math.round((Math.atan2(eX-origin,origin-eY))*180/Math.PI),
                s2 = Math.round((Math.atan(((eY-origin)*-1)/(eX-origin)*-1)*180/Math.PI)+90),
                s3 = Math.round(270-((Math.atan((eY-origin)/(origin-eX)))*180/Math.PI)),
                s4 = Math.round(270+(Math.atan((origin-eY)/((origin-eX)))*180/Math.PI))

        //then it converts it to dollar value
            if
                (eX >= origin && eY <= origin)
                {target.push(Math.round(s1*(goal/360)-current))}
            else if
                (eX >= origin && eY >= origin)
                {target.push(Math.round(s2*(goal/360)-current))}
            else if
                (eX <= origin && eY >= origin)
                {target.push(Math.round(s3*(goal/360)-current))}
            else if
                (eX <= origin && eY <= origin)
                {target.push(Math.round(s4*(goal/360)-current))}

                console.log(target)
        }



//constructor
        function Pie(f){
            this.f=f//finish angle
        }


//prototype
        Pie.prototype.update = function() {
            this.f += (document.getElementById("input").value - this.f) / 5;
            this.f == (document.getElementById("canvas").onmousedown.value - this.f)
            //console.log(this.f) //<-----enable this for overlay readout
        }

        Pie.prototype.draw = function() {
            ctx.strokeStyle="rgba(207,0,38,0.4)";
            ctx.lineWidth = lineW;
            ctx.beginPath();
        //update
            ctx.arc(
                origin,
                origin,
                radius,
                (currentAngle*Math.PI/180)+rot,
                //start angle
                ((currentAngle+(this.f/goal*360))*Math.PI/180)+rot,
                //end angle
                false);
            ctx.stroke();
            ctx.restore();
            //ctx.fillStyle="#ffffff";
            ctx.beginPath();
        //white center
            ctx.arc(
                origin,
                origin,
                core,
                0*Math.PI/180,
                360*Math.PI/180,
                false);
            ctx.fill();
        }

        var pie = new Pie (0)

        animate()

        function animate(){
            requestAnimationFrame(animate)
            pie.update()
            full ()
            pie.draw()
        }

        //re-draw the full chart on under the updated arc
        function full(){
        //box
            ctx.fillStyle = "rgba(255,255,255,0)";
            ctx.fillRect(0,0,origin*2,origin*2);

        //background
            ctx.strokeStyle="#ffa8ba";
            ctx.lineWidth = lineW;
            ctx.beginPath();
            ctx.arc(
                origin,
                origin,
                radius,
                0*Math.PI/180,
                360*Math.PI/180,
                false);
            ctx.stroke();

        //already met
            ctx.strokeStyle="#ff1646";
            ctx.lineWidth = lineW;
            ctx.beginPath();
            ctx.arc(
                origin,
                origin,
                radius,
                0*Math.PI/180+rot,
                currentAngle*Math.PI/180+rot,
                false);
            ctx.stroke();
            }
        </script>

    </body>

</html>