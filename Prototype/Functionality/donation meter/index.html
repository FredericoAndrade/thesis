<!DOCTYPE html>
<html>
    <head>

        <meta
            http-equiv="Content-Type"
            content="text/html; charset=UTF-8">

        <link
            rel="shortcut icon"
            href="http://fredericoandrade.com/images/favicon.ico">

        <link
            href="style.css"
            rel="stylesheet"
            type="text/css">

        <link
            href='http://fonts.googleapis.com/css?family=Open+Sans:300'
            rel='stylesheet'
            type='text/css'>

        <title>
            FREDERICO ANDRADE - INTERACTION DESIGNER - Thesis Functionality Protoype 01</title>

        <script>
//mathematic values
        var goal=100,
			current = 22,
            target = []
//modifier
        var currentAngle = (current/goal)*360
        </script>

    </head>

    <body>
        <div id="overlay">

            <div id="readout">
                <h1 class="goal">
                    Goal: $
                    <script type="text/javascript">
                    document.write(goal);
                    </script>
                </h1>

                <h1 class="goal">
                    Funded: $
                    <script type="text/javascript">
                    document.write(current);
                    </script>

                </h1>
            </div>

             <div id="valueBox">

                    <canvas
                        id="val"
                        width="100px"
                        height="57px">
                    </canvas>

                    <input
                        id="input"
                        name="currency"
                        type="number"
                        step="1"
                        min="0"
                        value='0'
                        />
                        <!--Value does not change based on fill Value-->
                </div>


            <!--on click - fires event-->
            <canvas
                onmousedown="showCoords(event)"
                id="canvas"
                width="350"
                height="350">
            </canvas><!--canvas size determined here-->

        </div>

        <script>
		var canvas = document.getElementById('canvas'),
            ctx = canvas.getContext('2d'),
            valueCanvas =document.getElementById('val'),
            c2 = valueCanvas.getContext('2d')

//graphic values
        var origin = 175,
            radius = 100,
            lineW = 1.5*(radius),
            core = (radius/3.5),
            rot = Math.PI*-.5,
            bColor = '#F4F4F4', //#ffa8ba pink
            metColor = "rgba(255,22,70,.85)",
            tarColor = "rgba(154,22,70,.85)"


//pie-chart mouse-click value log
        function showCoords(evt){
            var eY = evt.layerY,
                eX = evt.layerX,
                //this breaks the chart into sectors
                //then it figures out the angle of the click from the origin
                s1 = (Math.atan2(eX-origin,origin-eY))*180/Math.PI,
                s2 = (Math.atan(((eY-origin)*-1)/(eX-origin)*-1)*180/Math.PI)+90,
                s3 = 270-((Math.atan((eY-origin)/(origin-eX)))*180/Math.PI),
                s4 = 270+(Math.atan((origin-eY)/((origin-eX)))*180/Math.PI)

        //then it converts it to dollar value
            if
                (eX >= origin && eY <= origin)
                {target=(s1*(goal/360)-current)}
            else if
                (eX >= origin && eY >= origin)
                {target=(s2*(goal/360)-current)}
            else if
                (eX <= origin && eY >= origin)
                {target=(s3*(goal/360)-current)}
            else if
                (eX <= origin && eY <= origin)
                {target=(s4*(goal/360)-current)}

        console.log('$'+Math.round(target))
        document.getElementById('input').value=Math.round(target);

        }

//constructor
        function Pie(f){
            this.f=f
//finish angle
        }

//prototype
        Pie.prototype.update = function() {
            if(showCoords){this.f += (target-this.f)/5;}
            else if(/*i dont know what to put here*/a){
            this.f += (document.getElementById("input").value - this.f) / 5;
            this.f == (document.getElementById("canvas").onmousedown.value - this.f)
        }

        }

        Pie.prototype.draw = function() {
            ctx.strokeStyle=tarColor;
            ctx.lineWidth = lineW;
            ctx.beginPath();
//update
            ctx.arc(
                origin,
                origin,
                radius,
            //start angle
                (currentAngle*Math.PI/180)+rot,
            //end angle
                ((currentAngle+(this.f/goal*360))*Math.PI/180)+rot,
                false);
            ctx.stroke();
            ctx.restore();
            //ctx.fillStyle="#ffffff";
            ctx.beginPath();
        //white center
            ctx.arc(
                origin,
                origin,
                core,
                0*Math.PI/180,
                360*Math.PI/180,
                false);
            ctx.fill();
        }

        var pie = new Pie (0)

        animate()

        function animate(){
            requestAnimationFrame(animate)
            pie.update()
            full ()
            pie.draw()
        }

        //re-draw the full chart on under the updated arc
        function full(){
        //box
            ctx.fillStyle = "rgba(255,255,255,0)";
            ctx.fillRect(0,0,origin*2,origin*2);

        //background
            ctx.strokeStyle=bColor;
            ctx.lineWidth = lineW;
            ctx.beginPath();
            ctx.arc(
                origin,
                origin,
                radius,
                0*Math.PI/180,
                360*Math.PI/180,
                false);
            ctx.stroke();

        //already met
            ctx.strokeStyle=metColor;
            ctx.lineWidth = lineW;
            ctx.beginPath();
            ctx.arc(
                origin,
                origin,
                radius,
                0*Math.PI/180+rot,
                currentAngle*Math.PI/180+rot,
                false);
            ctx.stroke();
            }

        function valBox () {
            c2.fillStyle="rgba(250,250,250,.96)";
            c2.strokeStyle="rgba(245,245,245,.96)";
            c2.beginPath();
            c2.lineTo(15,0);
            c2.lineTo(0,27);
            c2.lineTo(15,54);
            c2.lineTo(100,54);
            c2.lineTo(100,0);
            c2.closePath();
            c2.fill();
            c2.stroke();

            c2.strokeStyle="rgba(167,205,250,.36)";
            c2.beginPath();
            c2.lineWidth='3';
            c2.moveTo(0,29);
            c2.lineTo(15,55);
            c2.lineTo(100,55);
            c2.stroke();

        }

        valBox()
        </script>

    </body>

</html>